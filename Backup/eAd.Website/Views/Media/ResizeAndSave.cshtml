@model dynamic

@{
    ViewBag.Title = "title";
}

<!DOCTYPE html>

<html>
<head runat="server">
    <title>Index</title>
   
    <link href="@Url.Content("~/Content/jquery.Jcrop.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery-1.5.1.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Uploadify/swfobject.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Uploadify/jquery.uploadify.v2.1.4.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.Jcrop.min.js")" type="text/javascript"></script>
    <script type="text/javascript">
        var x = 0, y = 0, w = 0, h = 0;
        var imageHandler = "ImageHandler.ashx?id=";

        $(function () {
//            // Uploadify File Upload System
//            // SessionSync data is sent in scriptData for security reasons, see UploadifySessionSync() in global.asax
//            var uploadifyAuthCookie = '@(Request.Cookies[FormsAuthentication.FormsCookieName] == null ? string.Empty : Request.Cookies[FormsAuthentication.FormsCookieName].Value)';
//            var uploadifySessionId = '@Session.SessionID';

//            $("#fuFileUploader").uploadify({
//                'hideButton': true,       // We use a trick below to overlay a fake html upload button with this hidden flash button                         
//                'wmode': 'transparent',
//                'uploader': '@Url.Content("~/Uploadify/uploadify.swf")',
//                'cancelImg': '@Url.Content("~/Uploadify/cancel.png")',
//                'buttonText': 'Upload File',
//                'script': '@Url.Action("FileUpload", "Media")',
//                'multi': true,
//                'auto': true,
//                'fileExt': '*.jpg;*.gif;*.png;*.jpeg',
//                'fileDesc': 'Image Files',
//                'scriptData': { RequireUploadifySessionSync: true, SecurityToken: uploadifyAuthCookie, SessionId: uploadifySessionId },
//                'onComplete': function (event, id, fileObj, response, data) {
//                    response = $.parseJSON(response);
//                    if (response.Status == 'OK') {
//                        $("#pnlUpload").hide();
//                        $("#pnlUploadedImage").show();
//                        $("#imgUploadedImage").attr("src", imageHandler + response.Id);
//                        $('#imgUploadedImage').Jcrop({
//                            onChange: setCoords,
//                            onSelect: setCoords
//                            //minSize: [200, 200],
//                            //maxSize: [200, 200]
//                        });
//                    }
//                }
//            });
        //    $("#imgUploadedImage").attr("src", imageHandler + response.Id);
                                    $('#imgUploadedImage').Jcrop({
                                        onChange: setCoords,
                                        onSelect: setCoords,
                                        minSize: [200, 200],
                                        maxSize: [200, 200]
                                    });
          
        });

        function setCoords(c) {
            x = c.x;
            y = c.y;
            w = c.w;
            h = c.h;
        };

        function cropImage() {
            $.ajax({
                url: "@Url.Action("CropImage", "Media" )",
                type: "POST",
                data: { x: x, y: y, w: w, h: h, url: $('#imgUploadedImage').attr('src')  },
                success: function (data) {
                    $('#lblMethodError').hide();
                    $("#pnlNewImage").show();
                    $("#imgNewImage").attr("src", data);
                },
                error: function (xhr, status, error) {
                    // Show the error
                    $('#lblMethodError').text(xhr.responseText);
                    $('#lblMethodError').show();
                }
            });

        }

        function resizeImage() {
            // Call the server side function to resize the image
            $.ajax({
                url: "@Url.Action("ResizeImage", "Media")",
                type: "POST",
                success: function (data) {
                    $('#lblMethodError').hide();
                    $("#pnlNewImage").show();
                    $("#imgNewImage").attr("src",  data);
                },
                error: function (xhr, status, error) {
                    // Show the error
                    $('#lblMethodError').text(xhr.responseText);
                    $('#lblMethodError').show();
                }
            });
        }
    </script>
</head>
<body>
    
    <div>
        <div id="pnlUploadedImage" >
            <h2>Uploaded image</h2>
            <input type="button" id="btnCrop" onclick="javascript:cropImage();" value="Crop Image" />
            <input type="button" id="btnResize" onclick="javascript:resizeImage();" value="Resize Image" />
            <label id="lblMethodError" style="display:none"></label>
            <br />
            <img src="@ViewBag.Image" id="imgUploadedImage" alt="Uploaded Image" />
        </div>
        <div id="pnlNewImage" >
            <h2>Modified image</h2>
            <img src="" id="imgNewImage" alt="Image" />
        </div>
    </div>
</body>
</html>
